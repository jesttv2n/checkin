<!DOCTYPE html>
<html lang="da">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - TV2 Nord Event</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        min-height: 100vh;
        color: white;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .login-form {
        display: none;
        max-width: 400px;
        margin: 100px auto;
        padding: 20px;
      }

      .login-form.show {
        display: block;
      }

      .admin-container {
        display: none;
      }

      .admin-container.show {
        display: block;
      }

      .card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        margin-bottom: 20px;
      }

      .admin-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .admin-header h1 {
        font-size: 36px;
        color: #ff6b35;
        margin-bottom: 10px;
      }

      .admin-header p {
        font-size: 18px;
        opacity: 0.9;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.1);
        padding: 25px;
        border-radius: 15px;
        text-align: center;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .stat-number {
        font-size: 48px;
        font-weight: bold;
        color: #ff6b35;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .stat-label {
        font-size: 14px;
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .daily-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      .map-container {
        background: rgba(255, 255, 255, 0.1);
        padding: 30px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .map-container h3 {
        color: #ff6b35;
        margin-bottom: 20px;
        text-align: center;
        font-size: 24px;
      }

      .kommune-list {
        background: rgba(255, 255, 255, 0.1);
        padding: 30px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .kommune-list h3 {
        color: #ff6b35;
        margin-bottom: 20px;
        text-align: center;
        font-size: 24px;
      }

      .kommune-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 10px;
      }

      .kommune-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background 0.2s;
      }

      .kommune-item:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      .kommune-count {
        font-weight: bold;
        color: #ff6b35;
        font-size: 18px;
      }

      .historical-section {
        background: rgba(255, 255, 255, 0.1);
        padding: 30px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        margin-bottom: 20px;
      }

      .historical-section h3 {
        color: #ff6b35;
        margin-bottom: 20px;
        text-align: center;
        font-size: 24px;
      }

      .daily-breakdown {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 15px;
      }

      .day-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }

      .day-date {
        font-size: 12px;
        opacity: 0.8;
        margin-bottom: 5px;
      }

      .day-count {
        font-size: 24px;
        font-weight: bold;
        color: #ff6b35;
      }

      .controls {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
        justify-content: center;
      }

      .btn {
        background: #ff6b35;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .btn:hover {
        background: #e55a30;
      }

      .btn-secondary {
        background: #666;
      }

      .btn-secondary:hover {
        background: #555;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        font-size: 16px;
      }

      input {
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        background: rgba(255, 255, 255, 0.9);
        color: #333;
      }

      input:focus {
        outline: 2px solid #ff6b35;
        background: white;
      }

      .error {
        color: #ff4444;
        margin-top: 10px;
        text-align: center;
      }

      .success {
        color: #4caf50;
        margin-top: 10px;
        text-align: center;
      }

      .logout-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(255, 107, 53, 0.8);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
      }

      .logout-btn:hover {
        background: rgba(255, 107, 53, 1);
      }

      @media (max-width: 768px) {
        .daily-stats {
          grid-template-columns: 1fr;
        }

        .stats-grid {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }

        .controls {
          flex-direction: column;
          align-items: center;
        }
      }
    </style>
  </head>
  <body>
    <!-- Login Form -->
    <div class="login-form show" id="loginForm">
      <div class="card">
        <div class="admin-header">
          <h1>Admin Login</h1>
          <p>TV2 Nord Event Dashboard</p>
        </div>

        <form id="authForm">
          <div class="form-group">
            <label for="username">Brugernavn:</label>
            <input type="text" id="username" required />
          </div>
          <div class="form-group">
            <label for="password">Adgangskode:</label>
            <input type="password" id="password" required />
          </div>
          <button type="submit" class="btn" style="width: 100%">Log ind</button>
          <div class="error" id="loginError"></div>
        </form>
      </div>
    </div>

    <!-- Admin Dashboard -->
    <div class="container">
      <div class="admin-container" id="dashboard">
        <button class="logout-btn" onclick="logout()">Log ud</button>

        <div class="admin-header">
          <h1>Event Dashboard</h1>
          <p>Komplet oversigt over event-statistik</p>
        </div>

        <!-- Quick Stats -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number" id="todayTotal">0</div>
            <div class="stat-label">Bes√∏gende i dag</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="totalVisitors">0</div>
            <div class="stat-label">Total bes√∏gende</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="totalDays">1</div>
            <div class="stat-label">Aktive dage</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="avgDaily">0</div>
            <div class="stat-label">Gns. per dag</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="topKommune">-</div>
            <div class="stat-label">Mest aktive kommune</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="lastRegistration">-</div>
            <div class="stat-label">Seneste registrering</div>
          </div>
        </div>

        <!-- Controls -->
        <div class="controls">
          <button class="btn" onclick="refreshData()">üîÑ Opdater data</button>
          <button class="btn btn-secondary" onclick="exportData()">
            üìä Eksporter data
          </button>
          <button
            class="btn btn-secondary"
            onclick="clearTodayData()"
            title="Kun til test - fjerner dagens data"
          >
            üóëÔ∏è Nulstil dag (test)
          </button>
        </div>

        <!-- Daily Stats and Map -->
        <div class="daily-stats">
          <!-- Kommune Distribution -->
          <div class="kommune-list">
            <h3>Kommune-fordeling (i dag)</h3>
            <div class="kommune-stats" id="kommuneStats">
              <!-- Generated by JavaScript -->
            </div>
          </div>

          <!-- Map -->
          <div class="map-container">
            <h3>Nordjylland Kort</h3>
            <svg
              viewBox="0 0 400 300"
              style="
                width: 100%;
                height: auto;
                background: #f0f8ff;
                border-radius: 8px;
              "
            >
              <!-- Map regions -->
              <g id="mapRegions">
                <!-- Thisted -->
                <polygon
                  points="20,80 80,70 85,120 25,130"
                  fill="#e3f2fd"
                  stroke="#1976d2"
                  stroke-width="1"
                  data-kommune="Thisted"
                >
                  <title>Thisted</title>
                </polygon>

                <!-- Mors√∏ -->
                <circle
                  cx="60"
                  cy="140"
                  r="15"
                  fill="#e3f2fd"
                  stroke="#1976d2"
                  stroke-width="1"
                  data-kommune="Mors√∏"
                >
                  <title>Mors√∏</title>
                </circle>

                <!-- Vesthimmerland -->
                <polygon
                  points="85,120 140,115 145,160 90,165"
                  fill="#e3f2fd"
                  stroke="#1976d2"
                  stroke-width="1"
                  data-kommune="Vesthimmerland"
                >
                  <title>Vesthimmerland</title>
                </polygon>

                <!-- Aalborg -->
                <polygon
                  points="140,115 200,110 205,155 145,160"
                  fill="#e3f2fd"
                  stroke="#1976d2"
                  stroke-width="1"
                  data-kommune="Aalborg"
                >
                  <title>Aalborg</title>
                </polygon>

                <!-- Mariagerfjord -->
                <polygon
                  points="145,160 205,155 210,200 150,205"
                  fill="#e3f2fd"
                  stroke="#1976d2"
                  stroke-width="1"
                  data-kommune="Mariagerfjord"
                >
                  <title>Mariagerfjord</title>
                </polygon>

                <!-- Rebild -->
                <polygon
                  points="90,165 145,160 150,205 95,210"
                  fill="#e3f2fd"
                  stroke="#1976d2"
                  stroke-width="1"
                  data-kommune="Rebild"
                >
                  <title>Rebild</title>
                </polygon>

                <!-- Jammerbugt -->
                <polygon
                  points="80,70 140,65 145,110 85,115"
                  fill="#e3f2fd"
                  stroke="#1976d2"
                  stroke-width="1"
                  data-kommune="Jammerbugt"
                >
                  <title>Jammerbugt</title>
                </polygon>

                <!-- Br√∏nderslev -->
                <polygon
                  points="140,65 200,60 205,105 145,110"
                  fill="#e3f2fd"
                  stroke="#1976d2"
                  stroke-width="1"
                  data-kommune="Br√∏nderslev"
                >
                  <title>Br√∏nderslev</title>
                </polygon>

                <!-- Hj√∏rring -->
                <polygon
                  points="200,60 280,50 285,95 205,105"
                  fill="#e3f2fd"
                  stroke="#1976d2"
                  stroke-width="1"
                  data-kommune="Hj√∏rring"
                >
                  <title>Hj√∏rring</title>
                </polygon>

                <!-- Frederikshavn -->
                <polygon
                  points="280,50 350,40 355,85 285,95"
                  fill="#e3f2fd"
                  stroke="#1976d2"
                  stroke-width="1"
                  data-kommune="Frederikshavn"
                >
                  <title>Frederikshavn</title>
                </polygon>

                <!-- L√¶s√∏ -->
                <circle
                  cx="320"
                  cy="20"
                  r="8"
                  fill="#e3f2fd"
                  stroke="#1976d2"
                  stroke-width="1"
                  data-kommune="L√¶s√∏"
                >
                  <title>L√¶s√∏</title>
                </circle>
              </g>

              <!-- Labels -->
              <text
                x="200"
                y="280"
                text-anchor="middle"
                font-size="12"
                fill="#666"
              >
                Nordjylland
              </text>
            </svg>
          </div>
        </div>

        <!-- Historical Data -->
        <div class="historical-section">
          <h3>Daglig oversigt (alle dage)</h3>
          <div class="daily-breakdown" id="dailyBreakdown">
            <!-- Generated by JavaScript -->
          </div>
        </div>
      </div>
    </div>

    <script>
      // Admin credentials
      const ADMIN_USER = "admin";
      const ADMIN_PASS = "nordjylland2025";

      // Data storage
      let visitors = [];
      let todayKey = new Date().toDateString();

      // Initialize
      loadData();

      // Login handling
      document
        .getElementById("authForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const username = document.getElementById("username").value;
          const password = document.getElementById("password").value;

          if (username === ADMIN_USER && password === ADMIN_PASS) {
            document.getElementById("loginForm").classList.remove("show");
            document.getElementById("dashboard").classList.add("show");
            updateAllStats();
            document.getElementById("loginError").textContent = "";
          } else {
            document.getElementById("loginError").textContent =
              "Forkert brugernavn eller adgangskode";
          }
        });

      function logout() {
        document.getElementById("dashboard").classList.remove("show");
        document.getElementById("loginForm").classList.add("show");
        document.getElementById("username").value = "";
        document.getElementById("password").value = "";
      }

      function loadData() {
        visitors = JSON.parse(localStorage.getItem("eventVisitors") || "[]");
        updateAllStats();
      }

      function refreshData() {
        loadData();
        showMessage("Data opdateret!", "success");
      }

      function updateAllStats() {
        const today = visitors.filter((v) => v.date === todayKey);
        const todayTotal = today.reduce((sum, v) => sum + v.antal, 0);
        const totalVisitors = visitors.reduce((sum, v) => sum + v.antal, 0);

        // Basic stats
        document.getElementById("todayTotal").textContent = todayTotal;
        document.getElementById("totalVisitors").textContent = totalVisitors;

        // Calculate unique days and average
        const uniqueDays = [...new Set(visitors.map((v) => v.date))];
        const totalDays = Math.max(1, uniqueDays.length);
        document.getElementById("totalDays").textContent = totalDays;
        document.getElementById("avgDaily").textContent = Math.round(
          totalVisitors / totalDays
        );

        // Top kommune
        const kommuneStats = {};
        today.forEach((v) => {
          kommuneStats[v.kommune] = (kommuneStats[v.kommune] || 0) + v.antal;
        });

        const topKommune = Object.keys(kommuneStats).reduce(
          (a, b) => ((kommuneStats[a] || 0) > (kommuneStats[b] || 0) ? a : b),
          "Ingen data"
        );

        document.getElementById("topKommune").textContent =
          Object.keys(kommuneStats).length > 0 ? topKommune : "Ingen data";

        // Last registration
        if (visitors.length > 0) {
          const lastVisitor = visitors[visitors.length - 1];
          const lastTime = new Date(lastVisitor.timestamp).toLocaleTimeString(
            "da-DK",
            {
              hour: "2-digit",
              minute: "2-digit",
            }
          );
          document.getElementById("lastRegistration").textContent = lastTime;
        } else {
          document.getElementById("lastRegistration").textContent =
            "Ingen endnu";
        }

        // Update detailed views
        updateKommuneStats(kommuneStats);
        updateMap(kommuneStats);
        updateDailyBreakdown(uniqueDays);
      }

      function updateKommuneStats(stats) {
        const container = document.getElementById("kommuneStats");
        const kommuner = [
          "Aalborg",
          "Br√∏nderslev",
          "Frederikshavn",
          "Hj√∏rring",
          "Jammerbugt",
          "L√¶s√∏",
          "Mariagerfjord",
          "Mors√∏",
          "Rebild",
          "Thisted",
          "Vesthimmerland",
          "Anden del af Danmark",
        ];

        container.innerHTML = "";

        kommuner.forEach((kommune) => {
          const count = stats[kommune] || 0;
          const div = document.createElement("div");
          div.className = "kommune-item";
          div.innerHTML = `
                    <span>${kommune}</span>
                    <span class="kommune-count">${count}</span>
                `;
          container.appendChild(div);
        });
      }

      function updateMap(stats) {
        const maxCount = Math.max(...Object.values(stats), 1);

        document.querySelectorAll("[data-kommune]").forEach((element) => {
          const kommune = element.getAttribute("data-kommune");
          const count = stats[kommune] || 0;
          const intensity = count / maxCount;

          // Color based on visitor count
          const hue = 200; // Blue hue
          const saturation = 70 + intensity * 30; // 70-100%
          const lightness = 90 - intensity * 40; // 90-50%

          element.style.fill = `hsl(${hue}, ${saturation}%, ${lightness}%)`;

          // Update title
          const title = element.querySelector("title");
          if (title) {
            title.textContent = `${kommune}: ${count} bes√∏gende`;
          }
        });
      }

      function updateDailyBreakdown(uniqueDays) {
        const container = document.getElementById("dailyBreakdown");
        container.innerHTML = "";

        if (uniqueDays.length === 0) {
          container.innerHTML =
            '<div style="text-align: center; opacity: 0.7; padding: 20px;">Ingen data endnu</div>';
          return;
        }

        // Sort days chronologically
        uniqueDays.sort((a, b) => new Date(a) - new Date(b));

        uniqueDays.forEach((date) => {
          const dayVisitors = visitors.filter((v) => v.date === date);
          const dayTotal = dayVisitors.reduce((sum, v) => sum + v.antal, 0);

          const dayItem = document.createElement("div");
          dayItem.className = "day-item";

          const displayDate = new Date(date).toLocaleDateString("da-DK", {
            day: "2-digit",
            month: "2-digit",
          });

          dayItem.innerHTML = `
                    <div class="day-date">${displayDate}</div>
                    <div class="day-count">${dayTotal}</div>
                `;

          if (date === todayKey) {
            dayItem.style.background = "rgba(255, 107, 53, 0.3)";
            dayItem.style.border = "2px solid #ff6b35";
          }

          container.appendChild(dayItem);
        });
      }

      function exportData() {
        const dataStr = JSON.stringify(visitors, null, 2);
        const dataBlob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement("a");
        link.href = url;
        link.download = `tv2nord-event-data-${
          new Date().toISOString().split("T")[0]
        }.json`;
        link.click();
        URL.revokeObjectURL(url);
        showMessage("Data eksporteret!", "success");
      }

      function clearTodayData() {
        if (
          confirm(
            "Er du sikker p√• at du vil slette dagens data? (Kun til test)"
          )
        ) {
          visitors = visitors.filter((v) => v.date !== todayKey);
          localStorage.setItem("eventVisitors", JSON.stringify(visitors));
          updateAllStats();
          showMessage("Dagens data slettet!", "success");
        }
      }

      function showMessage(text, type) {
        const existing = document.querySelector(".message");
        if (existing) existing.remove();

        const message = document.createElement("div");
        message.className = `message ${type}`;
        message.textContent = text;
        message.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === "success" ? "#4caf50" : "#ff4444"};
                color: white;
                padding: 10px 20px;
                border-radius: 6px;
                z-index: 1000;
            `;

        document.body.appendChild(message);
        setTimeout(() => message.remove(), 3000);
      }

      // Auto-refresh every 30 seconds when dashboard is visible
      setInterval(() => {
        if (document.getElementById("dashboard").classList.contains("show")) {
          loadData();
        }
      }, 30000);

      // Daily reset check
      function checkDailyReset() {
        const today = new Date().toDateString();
        if (todayKey !== today) {
          todayKey = today;
          loadData();
        }
      }

      setInterval(checkDailyReset, 60000);
    </script>
  </body>
</html>
